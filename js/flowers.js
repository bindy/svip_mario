define(function(a,b,c){var d=function(a){var b=this,c=function(a,b){return~~(Math.random()*(b-a+1)+a)},d=function(a,b,c,d,e,f,g,h){return!(e>a+c||a>e+g||f>b+d||b>f+h)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),b.canvasid=a,b.init=function(){b.canvasid?b.canvas=document.getElementById(b.canvasid):($(document.body).append(b.canvas),b.canvas=document.createElement("canvas")),b.canvas.width=b.cw=document.documentElement.clientWidth,b.canvas.height=b.ch=document.documentElement.clientHeight-127,b.particles=[],b.partCount=50,b.fireworks=[],b.mx=b.cw/2,b.my=b.ch/2,b.currentHue=30,b.partSpeed=5,b.partSpeedVariance=10,b.partWind=10,b.partFriction=10,b.partGravity=1,b.hueMin=0,b.hueMax=180,b.fworkSpeed=10,b.fworkAccel=10,b.hueVariance=30,b.flickerDensity=0,b.showShockwave=!1,b.showTarget=!1,b.clearAlpha=25,b.ctx=b.canvas.getContext("2d"),b.ctx.lineCap="round",b.ctx.lineJoin="round",b.lineWidth=1,b.bindEvents(),b.canvasLoop(),b.canvas.onselectstart=function(){return!1}},b.createParticles=function(a,d,e){for(var f=b.partCount;f--;){var g={x:a,y:d,coordLast:[{x:a,y:d},{x:a,y:d},{x:a,y:d}],angle:c(0,360),speed:c(b.partSpeed-b.partSpeedVariance<=0?1:b.partSpeed-b.partSpeedVariance,b.partSpeed+b.partSpeedVariance),friction:1-b.partFriction/100,gravity:b.partGravity/2,hue:c(e-b.hueVariance,e+b.hueVariance),brightness:c(50,80),alpha:c(40,100)/100,decay:c(10,50)/1e3,wind:(c(0,b.partWind)-b.partWind/2)/25,lineWidth:b.lineWidth};b.particles.push(g)}},b.updateParticles=function(){for(var a=b.particles.length;a--;){var c=b.particles[a],e=c.angle*Math.PI/180,f=Math.cos(e)*c.speed,g=Math.sin(e)*c.speed;c.speed*=c.friction,c.coordLast[2].x=c.coordLast[1].x,c.coordLast[2].y=c.coordLast[1].y,c.coordLast[1].x=c.coordLast[0].x,c.coordLast[1].y=c.coordLast[0].y,c.coordLast[0].x=c.x,c.coordLast[0].y=c.y,c.x+=f,c.y+=g,c.y+=c.gravity,c.angle+=c.wind,c.alpha-=c.decay,(!d(0,0,b.cw,b.ch,c.x-c.radius,c.y-c.radius,2*c.radius,2*c.radius)||c.alpha<.05)&&b.particles.splice(a,1)}},b.drawParticles=function(){for(var a=b.particles.length;a--;){var d=b.particles[a],e=c(1,3)-1;if(b.ctx.beginPath(),b.ctx.moveTo(Math.round(d.coordLast[e].x),Math.round(d.coordLast[e].y)),b.ctx.lineTo(Math.round(d.x),Math.round(d.y)),b.ctx.closePath(),b.ctx.strokeStyle="hsla("+d.hue+", 100%, "+d.brightness+"%, "+d.alpha+")",b.ctx.stroke(),b.flickerDensity>0){var f=50-b.flickerDensity;if(c(0,f)===f){b.ctx.beginPath(),b.ctx.arc(Math.round(d.x),Math.round(d.y),c(d.lineWidth,d.lineWidth+3)/2,0,2*Math.PI,!1),b.ctx.closePath();var g=c(50,100)/100;b.ctx.fillStyle="hsla("+d.hue+", 100%, "+d.brightness+"%, "+g+")",b.ctx.fill()}}}},b.createFireworks=function(a,d,e,f){var g={x:a,y:d,startX:a,startY:d,hitX:!1,hitY:!1,coordLast:[{x:a,y:d},{x:a,y:d},{x:a,y:d}],targetX:e,targetY:f,speed:b.fworkSpeed,angle:Math.atan2(f-d,e-a),shockwaveAngle:Math.atan2(f-d,e-a)+90*(Math.PI/180),acceleration:b.fworkAccel/100,hue:b.currentHue,brightness:c(50,80),alpha:c(50,100)/100,lineWidth:b.lineWidth};b.fireworks.push(g)},b.updateFireworks=function(){for(var a=b.fireworks.length;a--;){var c=b.fireworks[a];b.ctx.lineWidth=c.lineWidth,vx=Math.cos(c.angle)*c.speed,vy=Math.sin(c.angle)*c.speed,c.speed*=1+c.acceleration,c.coordLast[2].x=c.coordLast[1].x,c.coordLast[2].y=c.coordLast[1].y,c.coordLast[1].x=c.coordLast[0].x,c.coordLast[1].y=c.coordLast[0].y,c.coordLast[0].x=c.x,c.coordLast[0].y=c.y,c.startX>=c.targetX?c.x+vx<=c.targetX?(c.x=c.targetX,c.hitX=!0):c.x+=vx:c.x+vx>=c.targetX?(c.x=c.targetX,c.hitX=!0):c.x+=vx,c.startY>=c.targetY?c.y+vy<=c.targetY?(c.y=c.targetY,c.hitY=!0):c.y+=vy:c.y+vy>=c.targetY?(c.y=c.targetY,c.hitY=!0):c.y+=vy,c.hitX&&c.hitY&&(b.createParticles(c.targetX,c.targetY,c.hue),b.fireworks.splice(a,1))}},b.drawFireworks=function(){var a=b.fireworks.length;for(b.ctx.globalCompositeOperation="lighter";a--;){var d=b.fireworks[a];b.ctx.lineWidth=d.lineWidth;var e=c(1,3)-1;b.ctx.beginPath(),b.ctx.moveTo(Math.round(d.coordLast[e].x),Math.round(d.coordLast[e].y)),b.ctx.lineTo(Math.round(d.x),Math.round(d.y)),b.ctx.closePath(),b.ctx.strokeStyle="hsla("+d.hue+", 100%, "+d.brightness+"%, "+d.alpha+")",b.ctx.stroke(),b.showTarget&&(b.ctx.save(),b.ctx.beginPath(),b.ctx.arc(Math.round(d.targetX),Math.round(d.targetY),c(1,8),0,2*Math.PI,!1),b.ctx.closePath(),b.ctx.lineWidth=1,b.ctx.stroke(),b.ctx.restore()),b.showShockwave&&(b.ctx.save(),b.ctx.translate(Math.round(d.x),Math.round(d.y)),b.ctx.rotate(d.shockwaveAngle),b.ctx.beginPath(),b.ctx.arc(0,0,1*(d.speed/5),0,Math.PI,!0),b.ctx.strokeStyle="hsla("+d.hue+", 100%, "+d.brightness+"%, "+c(25,60)/100+")",b.ctx.lineWidth=d.lineWidth,b.ctx.stroke(),b.ctx.restore())}},b.bindEvents=function(){function d(){var a=50+Math.random()*(b.canvas.width-100),d=20+120*Math.random();b.mx=a,b.my=d,b.currentHue=c(b.hueMin,b.hueMax),b.createFireworks(b.cw/2,b.ch,b.mx,b.my)}$(window).on("resize",function(){clearTimeout(b.timeout),b.timeout=setTimeout(function(){b.canvas.width=b.cw=$(window).width(),b.canvas.height=b.ch=$(window).height(),b.ctx.lineCap="round",b.ctx.lineJoin="round"},100)});var a=(new Date).getTime();!function e(){requestAnimFrame(e);var b=(new Date).getTime();b-a>1e3&&(d(),a=b)}()},b.clear=function(){b.particles=[],b.fireworks=[],b.ctx.clearRect(0,0,b.cw,b.ch)},b.canvasLoop=function(){requestAnimFrame(b.canvasLoop,b.canvas),b.ctx.globalCompositeOperation="destination-out",b.ctx.fillStyle="rgba(0,0,0,"+b.clearAlpha/100+")",b.ctx.fillRect(0,0,b.cw,b.ch),b.updateFireworks(),b.updateParticles(),b.drawFireworks(),b.drawParticles()},b.init()};c.exports=d});